import{$ as Q}from"./axios.6e50eb2b.js";import{_ as z}from"./index.de86c1f3.js";import{au as H,av as J,H as F,_ as L,az as K,o as t,c as s,a as y,F as f,a4 as m,V as _,J as k,K as S,T as h,u as q}from"./@vue.0b7daf70.js";import"./vue-router.6e1644ed.js";import"./jquery.ec3d1b5c.js";import"./dayjs.d8f219e1.js";import"./echarts.251b3508.js";import"./tslib.60310f1a.js";import"./zrender.6c46a122.js";import"./element-plus.7f6b61ee.js";import"./lodash-es.1d9717e1.js";import"./@vueuse.25190ef7.js";import"./@element-plus.9354d8c1.js";import"./@popperjs.36402333.js";import"./@ctrl.82a509e0.js";import"./async-validator.fb49d0f5.js";import"./memoize-one.4ee5c96d.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.8aeb3683.js";import"./@floating-ui.2c6bb732.js";H("data-v-7c486f2c");const $={class:"card"},j={border:"1",class:"card-table"},G={key:0},R={key:1},U={border:"0",style:{width:"100%"}},W={key:1},X=["rowspan"];J();const Y=F({props:{column:{type:Array,required:!0},params:{type:String,required:!0}},async setup(I,{expose:O}){let w,B;const n=I;O({clearTime:()=>{clearInterval(T),clearInterval(V)}});let p=35;const M=()=>new Promise(l=>{if(n.params==="\u6574\u673A")Q.get("http://192.168.112.160/mes/stock/turnover/inventoryTurnover?workShop=A002").then(a=>{window.sessionStorage.setItem("data",JSON.stringify(a)),l(a.data)});else{let a=function(){let e=JSON.parse(window.sessionStorage.getItem("data"));e?l(e.data):setTimeout(()=>{a()},100)};a()}}),v=()=>{let l=document.querySelectorAll(".child_table");if(l.length===0)setTimeout(()=>{v()},50);else{let a=document.querySelector(".dd");l.forEach(e=>{e.style.height=(a==null?void 0:a.scrollHeight)+"px"})}};let u=0,T=null;const N=(l,a)=>{T=setInterval(()=>{var e;switch(a){case"PCBA_A":(u+1)*35>=l?u=0:u+=1,i.completeDetails=r.pcbaAmounts.slice(u*35,(u+1)*35);break;case"PCBA_I":let c=p;if(p+30>r.pcbaDetails.length)i.pcbaDetails=r.pcbaDetails.slice(c,r.pcbaDetails.length),p=0;else{for(let d=p+30;d<p+35;d++)if(r.pcbaDetails[d].productCode!==((e=r.pcbaDetails[d+1])==null?void 0:e.productCode)){p=d+1;break}console.log(p),i.pcbaDetails=r.pcbaDetails.slice(c,p),console.log(i.pcbaDetails)}break;case"\u6574\u673A":document.querySelectorAll(".child_table").forEach(d=>{d.style.height="0px"}),i.completeDetails[0]=r.completeDetails[u+1],setTimeout(()=>{v()},10),u===l-2?u=-1:u+=1;break}},20*1e3)};let r=L({}),i=L({completeDetails:[]});window.sessionStorage.removeItem("data");let b=([w,B]=K(()=>M()),w=await w,B(),w);if(b.code===200&&b.result){if(r=b.result,n.params==="PCBA_A")i.completeDetails=r.pcbaAmounts.slice(0,35),N(r.pcbaAmounts.length,"PCBA_A");else if(n.params==="\u6574\u673A")i.completeDetails[0]=r.completeDetails[0],N(r.completeDetails.length,"\u6574\u673A"),v();else if(n.params==="PCBA_I"){let l={pcbaDetails:[]};r.pcbaDetails.forEach(a=>{a.pcbaPlanMsgs.forEach((e,c)=>{e.planCode===null&&a.pcbaPlanMsgs.splice(c,1)})}),r.pcbaDetails.forEach(a=>{a.pcbaPlanMsgs.forEach((e,c)=>{l.pcbaDetails.push({productCode:a.productCode,stockNum:a.stockNum,planCode:e.planCode,plineName:e.plineName,planQty:e.planQty,offLine:e.offLine,row:a.pcbaPlanMsgs.length,rowIndex:c===0})})}),r.pcbaDetails=l.pcbaDetails;for(let a=30;a<35;a++)if(l.pcbaDetails[a].productCode!==l.pcbaDetails[a+1].productCode){p=a+1;break}console.log(l.pcbaDetails),i.pcbaDetails=l.pcbaDetails.slice(0,p),N(l.pcbaDetails.length,"PCBA_I")}}let V=setInterval(async()=>{if(window.sessionStorage.removeItem("data"),b=await M(),b.code===200&&b.result&&(r=b.result,n.params==="PCBA_I")){let l={pcbaDetails:[]};b.result.pcbaDetails.forEach(a=>{a.pcbaPlanMsgs.forEach((e,c)=>{e.planCode===null&&a.pcbaPlanMsgs.splice(c,1)})}),b.result.pcbaDetails.forEach(a=>{a.pcbaPlanMsgs.forEach((e,c)=>{l.pcbaDetails.push({productCode:a.productCode,stockNum:a.stockNum,planCode:e.planCode,plineName:e.plineName,planQty:e.planQty,offLine:e.offLine,row:a.pcbaPlanMsgs.length,rowIndex:c===0})})}),r.pcbaDetails=l.pcbaDetails}},3*1e3*60);return(l,a)=>(t(),s("div",$,[y("table",j,[y("thead",null,[(t(!0),s(f,null,m(I.column,(e,c)=>(t(),s("th",{key:c,class:"card-table-head-title"},_(e.value),1))),128))]),n.params!=="PCBA_I"?(t(),s("tbody",G,[(t(!0),s(f,null,m(q(i).completeDetails,(e,c)=>(t(),s("tr",{key:c},[(t(!0),s(f,null,m(I.column,(o,d)=>{var A,g;return t(),s("td",{key:d,class:k((c+1)%2===0?"oneClass":"twoClass")},[o.key!=="plineName"&&!o.noTraversal&&n.params==="\u6574\u673A"?(t(),s("table",{key:0,border:"0",style:{width:"100%"},class:k(o.noTraversal?"":"child_table")},[y("tbody",null,[(t(!0),s(f,null,m(e.workOrderMsgList,(P,D)=>{var C;return t(),s("tr",{class:k((D+1)%2===0?"oneClass":"twoClass"),key:D},[y("td",{style:S([{border:"none"},{borderBottom:D<e.workOrderMsgList.length-1?"1px solid #ffffff3a":"none"}])},_((C=P[o.key])!=null?C:"-"),5)],2)}),128))])],2)):h("",!0),o.key==="plineName"?(t(),s("span",R,_((A=e.plineName)!=null?A:"-"),1)):h("",!0),o.noTraversal&&n.params==="\u6574\u673A"?(t(),s("table",{key:2,border:"0",style:{width:"100%"},class:k(["dd",o.noTraversal?"traversal":""])},[y("tbody",null,[(t(!0),s(f,null,m(e.workOrderMsgList,(P,D)=>(t(),s("tr",{key:D},[y("table",U,[y("tbody",null,[(t(!0),s(f,null,m(P.pcbaMsgList,(C,x)=>{var E;return t(),s("tr",{key:x,class:k(x%2===0?"oneClass":"twoClass")},[y("td",{style:S([{border:"none"},{borderBottom:"1px solid #ffffff3a",color:C[o.key]<0?"red":""}])},_((E=C[o.key])!=null?E:"-"),5)],2)}),128))])])]))),128))])],2)):h("",!0),n.params==="PCBA_A"?(t(),s("span",{key:3,style:S({color:o.key=="stockNum"&&e[o.key]>e.needNum+200?"green":o.key=="needNum"&&e[o.key]>e.stockNum?"red":"#fff"})},_((g=e[o.key])!=null?g:"-"),5)):h("",!0)],2)}),128))]))),128))])):h("",!0),n.params==="PCBA_I"?(t(),s("tbody",W,[(t(!0),s(f,null,m(q(i).pcbaDetails,(e,c)=>(t(),s("tr",{key:c,class:k(c%2===0?"oneClass":"twoClass")},[(t(!0),s(f,null,m(n.column,(o,d,A)=>{var g;return t(),s(f,{key:A},[e.rowIndex||o.key!=="productCode"?(t(),s("td",{key:0,rowspan:e.rowIndex&&o.key==="productCode"?e.row:""},_((g=e[o.key])!=null?g:"-"),9,X)):h("",!0)],64)}),128))],2))),128))])):h("",!0)])]))}});var ke=z(Y,[["__scopeId","data-v-7c486f2c"]]);export{ke as default};
